<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Metadata for SEO and browser behavior -->
    <meta name="description" content="Track your favorite anime, explore new releases, discover hidden gems, and add them to your own personal watchlist.">
    <meta name="keywords" content="anime, animes, anime tracker, watchlist tracker, recommendations">
    <meta name="author" content="MirkoLouis">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Meerko</title>

    <link rel="icon" href="/favicon.png">

    <!-- Bootstrap CSS for styling and responsiveness -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Swiper CSS for carousels -->
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">
    <!-- Custom stylesheet -->
    <link rel="stylesheet" href="/style.css">

    <!-- jQuery (slim version) for certain functionalities -->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <!-- Swiper JS for interactive carousels -->
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <!-- Vanilla LazyLoad for lazy loading images -->
    <script src="/vendor/vanilla-lazyload/lazyload.min.js"></script>
</head>
<body>
    {{#if user}}
    <script nonce="{{cspNonce}}">
        // Safely expose the user object to the window for client-side scripts
        window.currentUser = {{{json user}}};
    </script>
    {{/if}}

    <!-- Alert Container -->
    <!-- This div serves as a container for displaying toast notifications or alerts to the user. -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1055;"></div>
    
    <!-- Navigation -->
    <!-- The main navigation bar, providing search functionality, links to other parts of the application,
    theme toggle, and conditional login/logout/dashboard links based on user authentication status. -->
    <nav class="navbar sticky-top px-5" style="color: #ffffff;">
        <div class="container-fluid">
            <div class="row w-100 align-items-center">
                <!-- Left: Logo -->
                <div class="col-md-3 d-flex align-items-center justify-content-start gap-3">
                    <h1 class="mb-0 d-flex align-items-center">
                        <a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                            Meerk
                            <img src="/favicon.png" alt="OWO" style="width: 32px; height: 32px; margin-top: 12px;">
                        </a>
                    </h1>

                    <button id="theme-toggle" class="btn btn-sm" title="Theme Toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-brilliance" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M1 8a7 7 0 0 0 7 7 3.5 3.5 0 1 0 0-7 3.5 3.5 0 1 1 0-7 7 7 0 0 0-7 7"/>
                        </svg>
                    </button>
                </div>

                <!-- Center: Search -->
                <div class="col-md-6 text-center">
                    <form id="search-form" class="d-inline-flex justify-content-center align-items-center w-50" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search anime..." aria-label="Search" id="search-input">
                        <button class="btn btn-warning" type="submit">Search</button>
                    </form>
                </div>

                <!-- Right: Navigation Links -->
                <div class="col-md-3 d-flex justify-content-end align-items-center">
                    <ul class="d-flex mb-0 align-items-center" style="gap: 25px; list-style: none;">
                        {{#if user}}
                            <li><a href="/">Home</a></li>
                            <li><a href="/dashboard">Dashboard</a></li>
                            <li>
                                <form action="/auth/logout" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm logout-btn">Logout</button>
                                </form>
                            </li>
                        {{else}}
                            <li><a href="/">Home</a></li>
                            <li><a href="/login">Login</a></li>
                            <li><a href="/register">Register</a></li>
                        {{/if}}
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Search Results Section -->
        <!-- This section displays the results of anime searches, including filters and pagination.
        It is initially hidden and becomes visible when a search is performed. -->
        <section id="search-results-section" style="display: none;">
            <div id="search-results-container" class="container my-5" style="display: none;">
                <h2>Search Results</h2>

                <!-- Filter dropdown container -->
                <div id="filter-row" class="row mb-4"></div>

                <!-- Selected tags container placed outside of the search results container -->
                <div id="selected-tags-container">
                    <!-- Tags will appear here -->
                </div>

                <div id="pagination-top"></div>
                <div id="search-results" class="row g-3">
                    <!-- Search results will be injected here -->
                </div>
                <div id="pagination-bottom" style="padding-top: 25px;"></div>
            </div>
        </section>

        <div class="bgimage" id="all-section">
            <!-- Spotlight Section -->
            <!-- This section displays a rotating spotlight of top animes, including details and an "Add to Watchlist" button. -->
            <section id="spotlight-section">
                <div class="container-fluid spotlight-wrapper my-5">
                    <div class="spotlight-banner">
                        <div id="anime-spotlight-container" class="row"></div>
                            <img src="/imnota-cat-fubuki.gif" alt="Anime Spotlight Image" class="spotlight-img" loading="eager">
                        <div class="spotlight-content">
                            <!-- Spotlight Animes will be injected here and replace labels -->
                            <h6 class="text-warning">TOP ANIMES</h6>
                            <h2 id="anime-title">Anime Title Here...</h2>
                            <p>
                                <span class="info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tags-fill mb-1" viewBox="0 0 16 16">
                                    <path d="M2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586zm3.5 4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
                                    <path d="M1.293 7.793A1 1 0 0 1 1 7.086V2a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l.043-.043z"/>
                                    </svg>
                                    <span class="info-text">Tags</span>
                                </span>
                                <span class="info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tv align-middle mb-1" viewBox="0 0 16 16">
                                    <path d="M2.5 13.5A.5.5 0 0 1 3 13h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5M13.991 3l.024.001a1.5 1.5 0 0 1 .538.143.76.76 0 0 1 .302.254c.067.1.145.277.145.602v5.991l-.001.024a1.5 1.5 0 0 1-.143.538.76.76 0 0 1-.254.302c-.1.067-.277.145-.602.145H2.009l-.024-.001a1.5 1.5 0 0 1-.538-.143.76.76 0 0 1-.302-.254C1.078 10.502 1 10.325 1 10V4.009l.001-.024a1.5 1.5 0 0 1 .143-.538.76.76 0 0 1 .254-.302C1.498 3.078 1.675 3 2 3zM14 2H2C0 2 0 4 0 4v6c0 2 2 2 2 2h12c2 0 2-2 2-2V4c0-2-2-2-2-2"/>
                                    </svg>
                                    <span class="info-text">TV</span>
                                </span>
                                <span class="info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-film align-middle mb-1" viewBox="0 0 16 16">
                                    <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm4 0v6h8V1zm8 8H4v6h8zM1 1v2h2V1zm2 3H1v2h2zM1 7v2h2V7zm2 3H1v2h2zm-2 3v2h2v-2zM15 1h-2v2h2zm-2 3v2h2V4zm2 3h-2v2h2zm-2 3v2h2v-2zm2 3h-2v2h2z"/>
                                    </svg>
                                    <span class="info-text">12 episodes</span>
                                </span>
                                <span class="info-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar align-middle mb-1" viewBox="0 0 16 16">
                                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                    </svg>
                                    <span class="info-text">3/25/2025</span>
                                </span>
                            </p>
                            <p id="anime-description">Anime description goes here...</p>
                            <button class="btn btn-watch btn-lg me-2 add-watchlist-button-hover" id="add-to-watchlist-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-square-fill align-middle mb-1" viewBox="0 0 16 16">
                                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.5 10a.5.5 0 0 0 .832.374l4.5-4a.5.5 0 0 0 0-.748l-4.5-4A.5.5 0 0 0 5.5 4z"/>
                                    </svg> Add to Watchlist</button>
                            <a id="view-details-btn" class="btn btn-secondary btn-lg me-2">View Details</a>
                        </div>
                    </div>
                    <div id="spotlight-nav" class="spotlight-nav"></div>
                </div>
            </section>

            <!-- Most Watchlist Section -->
            <!-- Displays a carousel of the most popular animes across all users,
            allowing discovery of trending series. -->
            <section class="mostwatchlist-section">
                <h2><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-heart mb-2" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/>
                    <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z"/>
                </svg> Most Watchlisted Animes</h2>
                <div id="mostWatchlistCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner" id="mostWatchlistCarouselInner">
                        <!-- Most Watchlisted Animes will be injected here -->
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#mostWatchlistCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#mostWatchlistCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </section>

            <!-- New and Upcoming Releases Carousel -->
            <!-- This section features carousels for both newly released and upcoming anime series,
            allowing users to stay updated with recent and future titles. -->
            <section class="new-and-upcoming-releases-section container-fluid">
                <div class="row">
                    <div class="col border-end pe-10">
                        <!-- New Releases Carousel -->
                        <div class="new-releases-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-fill mb-2" viewBox="0 0 16 16">
                                    <path d="M2 2v13.5a.5.5 0 0 0 .74.439L8 13.069l5.26 2.87A.5.5 0 0 0 14 15.5V2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2"/>
                                </svg> New Animes</h2>
                                <div class="d-flex gap-2">
                                <button class="carousel-nav-btn" type="button" data-bs-target="#newAnimesCarousel" data-bs-slide="prev" aria-label="Previous New Anime">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left align-middle mb-1" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                    </svg>
                                </button>
                                <button class="carousel-nav-btn" type="button" data-bs-target="#newAnimesCarousel" data-bs-slide="next" aria-label="Next New Anime">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right align-middle mb-1" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
                                    </svg>
                                </button>
                                </div>
                            </div>
                            <div id="newAnimesCarousel" class="carousel slide" data-bs-ride="false">
                                <div class="new-carousel-inner">
                                <!-- New Releases will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <!-- Upcoming Releases Carousel -->
                        <div class="upcoming-releases-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-fill mb-2" viewBox="0 0 16 16">
                                    <path d="M2 2v13.5a.5.5 0 0 0 .74.439L8 13.069l5.26 2.87A.5.5 0 0 0 14 15.5V2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2"/>
                                </svg> Upcoming Animes</h2>
                                <div class="d-flex gap-2">
                                <button class="carousel-nav-btn" type="button" data-bs-target="#upcomingAnimesCarousel" data-bs-slide="prev" aria-label="Previous Upcoming Anime">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left align-middle mb-1" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                    </svg>
                                </button>
                                <button class="carousel-nav-btn" type="button" data-bs-target="#upcomingAnimesCarousel" data-bs-slide="next" aria-label="Next Upcoming Anime">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right align-middle mb-1" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
                                    </svg>
                                </button>
                                </div>
                            </div>
                            <div id="upcomingAnimesCarousel" class="carousel slide" data-bs-ride="false">
                                <div class="upcoming-carousel-inner">
                                <!-- Upcoming Releases will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
                
            <!-- Featured Section -->
            <!-- Presents a curated selection of featured animes in an interactive carousel format,
            often based on high ratings or editorial picks. -->
            <section class="featured-section">
                <h2><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-heart mb-2" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 4.41c1.387-1.425 4.854 1.07 0 4.277C3.146 5.48 6.613 2.986 8 4.412z"/>
                    <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z"/>
                </svg> Featured Animes</h2>
                <div class="deslide-wrap">
                    <div id="slider" class="swiper-container">
                        <div class="swiper-wrapper">
                            <!-- Featured Animes will be injected here -->
                        </div>
                        <div class="swiper-pagination"></div>
                        <div class="swiper-nav-buttons">
                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Random Section -->
            <!-- Allows users to discover new animes by displaying a random selection,
            with a button to fetch a new set of random animes. -->
            <section class="random-section">
            <div class="header-with-button mb-3">
                <h2 class="header-title"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-plus-fill mb-2" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5m6.5-11a.5.5 0 0 0-1 0V6H6a.5.5 0 0 0 0 1h1.5v1.5a.5.5 0 0 0 1 0V7H10a.5.5 0 0 0 0-1H8.5z"/>
                </svg> Discover Something New</h2>
                <button id="randomizeBtn" class="btn btn-primary" aria-label="Randomize Button"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-shuffle align-middle mb-1" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>
                    <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>
                </svg></button>
            </div>
            <div class="anime-grid" id="random-animes">
                <!-- Random Animes will be injected here -->
            </div>
            </section>
        </div>
    </main>

    <!-- Main client-side JavaScript for fetching and rendering anime data, and managing user interactions. -->
    <script src="/js/utils.js"></script>
    <script src="/js/index-inline.js"></script>
    <script src="/js/watchlist.js"></script>
    <script src="/js/carousels.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/main.js"></script>
    <!-- Bootstrap JavaScript bundle for components like carousels, modals, and tooltips. -->
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <!-- Provides a warning message to users if JavaScript is disabled in their browser,
    as the site relies heavily on JavaScript for functionality. -->
    <noscript>
        <div class="alert alert-warning text-center" role="alert">
            This site requires JavaScript to function properly. Please enable it in your browser.
        </div>
    </noscript>
    <footer class="w-100 text-center py-1">
        <!-- Footer section displaying copyright information. -->
        <p class="mb-0">&copy; 2025 Meerko. All rights reserved. Made by Mirko for a final project.</p>
    </footer>
</body>
</html>